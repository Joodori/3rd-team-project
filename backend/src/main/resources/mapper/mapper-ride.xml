<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="lx.edu.levelup.feature.ride.RideRepository">
	<select id="getRideBookList" parameterType="int"
		resultType="lx.edu.levelup.feature.ride.RideResponseDTO">
		select c.ride_book_confirm_no, f.facility_name,
		i.ride_book_time, c.ride_book_person_amount
		from facility f
		join ride r
		on f.facility_no = r.facility_no
		join ride_book_infos i
		on r.facility_no
		= i.facility_no
		join ride_book_confirm c
		on i.ride_book_info_no =
		c.ride_book_no
		where c.user_no = #{user_no};
	</select>

	<select id="getRideReserveList"
		resultType="lx.edu.levelup.feature.ride.RideResponseDTO">
		SELECT f.facility_name, i.ride_book_time, f.facility_no
		FROM facility f
		INNER JOIN ride_book_infos i ON f.facility_no = i.facility_no;
	</select>

	<select id="getRideReserveByNo"
		parameterType = "int"
		resultType="lx.edu.levelup.feature.ride.RideResponseDTO">
		SELECT f.facility_name, i.ride_book_time, i.ride_book_info_no
		FROM facility f
		INNER JOIN ride_book_infos i ON f.facility_no = i.facility_no
		WHERE i.facility_no = #{facility_no}
	</select>

	<insert id="insertRideBookConfirm"
		parameterType="lx.edu.levelup.feature.ride.RideVO">
		insert into ride_book_confirm(user_no, ride_book_no,
		ride_book_person_amount)
		values(#{userNo}, #{rideBookNo},
		#{rideBookPersonAmount})
	</insert>

	<update id="updateRideBookInfoAmount"
		parameterType="lx.edu.levelup.feature.ride.RideVO">
		update ride_book_infos
		set ride_book_info_amount =
		ride_book_info_amount - #{rideBookPersonAmount}
		where ride_book_info_no
		= #{rideBookNo}
		and ride_book_info_amount >= #{rideBookPersonAmount}
	</update>

	<delete id="deleteRideBookConfirm" parameterType="int">
		delete from
		ride_book_confirm
		where ride_book_confirm_no = #{ride_book_confirm_no}
	</delete>
</mapper>